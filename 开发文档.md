# Windows局域网文件传输工具开发文档

## 1. 项目概述

本项目旨在开发一个基于Windows局域网的文件传输工具，通过Python实现，具备以下特点：
- 可视化GUI操作界面
- 基于Web的文件传输服务
- 支持多用户同时连接
- 本地文件系统存储
- 用户数据本地缓存
- 可打包为独立EXE程序

## 2. 系统架构

### 2.1 整体架构
```
┌─────────────────────────────────────────────────────────────────┐
│                     主程序 (main.py)                           │
├────────────┬─────────────────┬─────────────────────┬────────────┤
│  GUI模块   │    Web服务模块  │   文件管理模块      │  用户管理模块 │
│ (tkinter)  │  (Flask/SocketIO)│ (os/file_utils.py) │ (user_cache.py)│
└────────────┴─────────────────┴─────────────────────┴────────────┘
```

### 2.2 技术栈
- **GUI框架**：tkinter（Python内置，无需额外安装）
- **Web服务**：Flask + Flask-SocketIO（支持实时通信）
- **二维码生成**：qrcode
- **文件处理**：Python内置os、shutil模块
- **用户缓存**：JSON文件存储
- **打包工具**：PyInstaller

## 3. 功能模块设计

### 3.1 GUI模块

**功能说明**：提供可视化操作界面，用于控制服务和显示状态

**核心组件**：
- 启动/停止服务按钮
- Web URL二维码显示区域
- 运行日志文本框
- 系统状态显示

**实现思路**：
- 使用tkinter创建主窗口
- 集成qrcode库生成二维码
- 使用Text组件显示实时日志
- 通过多线程避免GUI卡顿

### 3.2 Web服务模块

**功能说明**：提供Web界面和实时通信服务

**核心组件**：
- Flask应用实例
- SocketIO服务（用于实时通信）
- Web路由（文件上传/下载、页面访问）

**实现思路**：
- 创建Flask应用，配置静态文件路径
- 使用SocketIO实现实时聊天和用户状态更新
- 设计RESTful API处理文件上传下载
- 实现WebSocket事件处理（用户连接/断开、消息发送）

### 3.3 文件管理模块

**功能说明**：处理文件的存储、读取、上传、下载

**核心组件**：
- 文件存储目录管理
- 文件上传处理
- 文件下载处理
- 文件列表生成

**实现思路**：
- 使用本地目录存储上传文件
- 实现分块上传（支持大文件）
- 提供文件元数据管理（大小、修改时间等）
- 支持断点续传（可选）

### 3.4 用户管理模块

**功能说明**：管理连接用户，处理用户认证和缓存

**核心组件**：
- 用户缓存（JSON文件）
- 用户ID生成
- 用户名管理
- 在线用户列表

**实现思路**：
- 使用JSON文件存储用户信息
- 基于IP地址和设备标识生成唯一用户ID
- 支持用户自定义用户名
- 维护在线用户列表，实时更新

## 4. 目录结构

```
file_transfer_tool/
├── main.py              # 主程序入口
├── gui/                 # GUI相关代码
│   └── app.py           # GUI应用实现
├── web/                 # Web服务相关代码
│   ├── __init__.py      # Web应用初始化
│   ├── routes.py        # Web路由定义
│   ├── socket_events.py # SocketIO事件处理
│   └── templates/       # HTML模板
│       └── index.html   # 主页面
├── utils/               # 工具函数
│   ├── file_utils.py    # 文件处理工具
│   ├── user_cache.py    # 用户缓存管理
│   └── logger.py        # 日志工具
├── static/              # 静态资源
│   ├── css/             # CSS样式
│   ├── js/              # JavaScript代码
│   └── uploads/         # 上传文件存储目录
├── config.json          # 配置文件
├── users.json           # 用户缓存文件
├── requirements.txt     # 依赖列表
└── README.md            # 项目说明
```

## 5. 核心功能实现思路

### 5.1 服务启动流程
1. 用户点击"启动服务"按钮
2. GUI模块调用Web服务模块启动Flask应用
3. 获取本地IP地址，生成访问URL
4. 生成二维码并显示在GUI中
5. 自动打开默认浏览器访问Web地址
6. 开始记录运行日志

### 5.2 用户连接流程
1. 用户通过浏览器访问Web地址
2. Web服务获取客户端IP和设备信息
3. 检查本地用户缓存，生成/获取用户ID
4. 向客户端返回用户信息
5. 广播新用户加入事件
6. 更新在线用户列表

### 5.3 文件上传流程
1. 用户在Web界面选择文件
2. 客户端发送文件元数据（文件名、大小等）
3. 服务端创建上传目录
4. 客户端分块上传文件
5. 服务端合并文件块
6. 更新文件列表并广播

### 5.4 文件下载流程
1. 用户在Web界面点击文件下载
2. 客户端发送下载请求
3. 服务端检查文件存在性
4. 服务端返回文件数据流
5. 客户端接收并保存文件

### 5.5 聊天功能实现
1. 用户在Web界面输入消息
2. 客户端通过SocketIO发送消息
3. 服务端接收消息并广播给所有在线用户
4. 所有客户端接收消息并显示

## 6. 配置文件设计

```json
{
    "server_port": 5000,
    "upload_dir": "static/uploads",
    "user_cache_file": "users.json",
    "log_level": "INFO",
    "auto_open_browser": true,
    "max_file_size": 104857600  // 100MB
}
```

## 7. 用户缓存设计

```json
{
    "users": [
        {
            "user_id": "uuid-1234-5678",
            "username": "用户1",
            "ip_address": "192.168.1.100",
            "device_info": "Windows-10",
            "last_seen": "2023-05-20 14:30:00"
        },
        {
            "user_id": "uuid-5678-1234",
            "username": "用户2",
            "ip_address": "192.168.1.101",
            "device_info": "Windows-11",
            "last_seen": "2023-05-20 14:25:00"
        }
    ]
}
```

## 8. 打包方案

### 8.1 依赖安装
```bash
pip install -r requirements.txt
```

### 8.2 打包命令
使用PyInstaller打包为单文件EXE：
```bash
pyinstaller --onefile --windowed --add-data "static;static" --add-data "web/templates;web/templates" main.py
```

## 9. 使用说明

### 9.1 启动程序
1. 双击运行生成的EXE文件
2. 点击"启动服务"按钮
3. 等待浏览器自动打开

### 9.2 访问Web界面
1. 在同一局域网内的其他设备上，打开浏览器
2. 扫描GUI窗口中的二维码，或直接输入显示的URL
3. 开始使用文件传输和聊天功能

### 9.3 文件操作
1. **上传文件**：点击"上传文件"按钮，选择要上传的文件
2. **下载文件**：在文件列表中点击要下载的文件名
3. **查看文件**：浏览文件列表，查看文件名、大小、上传时间

### 9.4 用户操作
1. **修改用户名**：在Web界面顶部输入新用户名，点击"修改"按钮
2. **查看在线用户**：在左侧用户列表查看当前在线用户
3. **发送消息**：在聊天框输入消息，按回车键发送

## 10. 注意事项

1. 确保所有设备在同一局域网内
2. 防火墙设置需要允许程序访问网络
3. 大文件上传可能需要较长时间，请勿关闭浏览器
4. 建议定期清理上传目录，避免占用过多磁盘空间
5. 程序运行时会在当前目录创建配置文件和用户缓存文件

## 11. 扩展功能建议

1. 添加文件搜索功能
2. 支持文件夹上传
3. 添加文件分享链接
4. 实现文件预览功能
5. 添加文件传输进度显示
6. 支持断点续传
7. 添加聊天消息历史记录
8. 实现文件权限管理

## 12. 技术风险与解决方案

| 风险 | 解决方案 |
|------|----------|
| 大文件上传导致内存溢出 | 实现分块上传，限制单次上传大小 |
| 多用户同时访问导致性能问题 | 使用线程池处理请求，优化文件IO |
| 防火墙阻止连接 | 提供防火墙设置指南，自动添加例外 |
| 端口冲突 | 允许用户自定义端口，自动检测可用端口 |
| EXE文件过大 | 使用虚拟环境，只打包必要依赖 |

## 13. 测试计划

1. **功能测试**：测试所有核心功能是否正常工作
2. **性能测试**：测试多用户同时连接时的性能
3. **兼容性测试**：测试在不同Windows版本上的运行情况
4. **网络测试**：测试不同网络环境下的传输速度
5. **文件测试**：测试不同大小、类型文件的上传下载

## 14. 项目进度安排

1. **需求分析与设计**：完成开发文档编写
2. **核心功能实现**：实现GUI、Web服务、文件管理、用户管理
3. **集成测试**：测试各模块之间的协作
4. **优化与调试**：解决性能问题和bug
5. **打包与发布**：生成EXE文件并测试
6. **文档完善**：更新使用说明和技术文档

## 15. 代码规范

1. 所有函数必须有注释说明功能和参数
2. 变量命名使用小写加下划线风格
3. 类命名使用驼峰式命名
4. 代码缩进使用4个空格
5. 每行代码不超过100个字符
6. 使用try-except处理异常
7. 日志记录使用标准logging模块
8. 配置参数集中管理

---

以上是Windows局域网文件传输工具的详细开发文档，涵盖了项目的各个方面。根据此文档，可以按照模块逐步实现功能，最终生成可执行的EXE程序。